CREATE DATABASE nhap_du_lieu2;

 USE nhap_du_lieu2;
 GO
-- Table SINHVIEN
CREATE TABLE SINHVIEN (
    MSSV NVARCHAR(10) PRIMARY KEY,
    TENSV NVARCHAR(50),
    DIACHI NVARCHAR(100),
    LOP NVARCHAR(10),
    SODT NVARCHAR(15)
);

INSERT INTO SINHVIEN VALUES ('97TH01', N'Nguyễn Văn An', '12 NTMK', '97TH01', '9688543');
INSERT INTO SINHVIEN VALUES ('97TH02', N'Lý An', '13/4 LCT', '97TH01', '8454433');
INSERT INTO SINHVIEN VALUES ('97TH03', N'Đinh Thúy Vân', '20 Pastuer', '97TH01', '8455789');
INSERT INTO SINHVIEN VALUES ('97TH04', N'Trần Văn Ngọc', '54/12 LHP', '97TH02', '8149023');
INSERT INTO SINHVIEN VALUES ('97TH05', N'Hà Khánh Ly', '12 HBT', '97TH02', '9851623');
INSERT INTO SINHVIEN VALUES ('97TH06', N'Nguyễn Bá Tòan', '31 THĐ', '97TH01', '9688531');

-- Table DETAI
CREATE TABLE DETAI (
    MSDT NVARCHAR(10) PRIMARY KEY,
    TENDT NVARCHAR(50)
);

INSERT INTO DETAI VALUES ('97001', N'Quản lý thư viện');
INSERT INTO DETAI VALUES ('97002', N'Nhận dạng vân tay');
INSERT INTO DETAI VALUES ('97003', N'Bán đấu giá trên mạng');
INSERT INTO DETAI VALUES ('97004', N'Quản lý siên thị');
INSERT INTO DETAI VALUES ('97005', N'Xử lý ảnh');

-- Table SV_DETAI
CREATE TABLE SV_DETAI (
    MSSV NVARCHAR(10) REFERENCES SINHVIEN(MSSV),
    MSDT NVARCHAR(10) REFERENCES DETAI(MSDT),
    PRIMARY KEY (MSSV, MSDT)
);

INSERT INTO SV_DETAI VALUES ('97TH01', '97004');
INSERT INTO SV_DETAI VALUES ('97TH02', '97005');
INSERT INTO SV_DETAI VALUES ('97TH03', '97001');
INSERT INTO SV_DETAI VALUES ('97TH04', '97002');
INSERT INTO SV_DETAI VALUES ('97TH05', '97003');
INSERT INTO SV_DETAI VALUES ('97TH06', '97005');

CREATE TABLE GIAOVIEN (
    MSGV INT PRIMARY KEY,
    TENGV NVARCHAR(50),
    DIACHI NVARCHAR(100),
    SODT NVARCHAR(15),
    MSHHAM INT,
    NAMHH INT
);

INSERT INTO GIAOVIEN VALUES (1, N'Trần Lan', '11 NVT', '8751515', 1, 1996);
INSERT INTO GIAOVIEN VALUES (2, N'Nguyễn Văn A', '23/5 LQĐ', '8515186', 1, 1996);
INSERT INTO GIAOVIEN VALUES (3, N'Lê Trung', '4 TC', '8235464', 1, 1996);
INSERT INTO GIAOVIEN VALUES (4, N'Nguyễn Bảo Thy', '78 NTMK', '8775588', 2, 1997);
INSERT INTO GIAOVIEN VALUES (5, N'Chu Hòai Ân', '71/4 TL', '8997859', 2, 1997);
INSERT INTO GIAOVIEN VALUES (6, N'Nguyễn Ngọc An', '11 HBT', '8457689', 2, 1997);

-- Table HOCVI
CREATE TABLE HOCVI (
    MSHV INT PRIMARY KEY,
    TENHV NVARCHAR(10)
);

INSERT INTO HOCVI VALUES (1, 'KS');
INSERT INTO HOCVI VALUES (2, 'CN');
INSERT INTO HOCVI VALUES (3, 'Th.S');
INSERT INTO HOCVI VALUES (4, 'TS');
INSERT INTO HOCVI VALUES (5, 'TSKH');

-- Table CHUYENNGANH
CREATE TABLE CHUYENNGANH (
    MSCN INT PRIMARY KEY,
    TENCN NVARCHAR(50)
);

INSERT INTO CHUYENNGANH VALUES (1, N'Hệ thống thông tin');
INSERT INTO CHUYENNGANH VALUES (2, N'Mạng');
INSERT INTO CHUYENNGANH VALUES (3, N'Đồ họa');
INSERT INTO CHUYENNGANH VALUES (4, N'Công nghệ phần mềm');

-- Table GV_HV_CN
CREATE TABLE GV_HV_CN (
    MSGV INT REFERENCES GIAOVIEN(MSGV),
    MSHV INT REFERENCES HOCVI(MSHV),
    MSCN INT REFERENCES CHUYENNGANH(MSCN),
    NAM INT,
    PRIMARY KEY (MSGV, MSHV, MSCN)
);

INSERT INTO GV_HV_CN VALUES (1, 1, 1, 1999);
INSERT INTO GV_HV_CN VALUES (1, 1, 2, 1999);
INSERT INTO GV_HV_CN VALUES (1, 2, 1, 1998);
INSERT INTO GV_HV_CN VALUES (2, 3, 2, 1997);
INSERT INTO GV_HV_CN VALUES (3, 2, 4, 1997);
INSERT INTO GV_HV_CN VALUES (4, 3, 2, 1996);

CREATE TABLE HOCHAM (
    MSHH INT PRIMARY KEY,
    TENHH NVARCHAR(50)
);

INSERT INTO HOCHAM VALUES (1, N'Phó giáo sư');
INSERT INTO HOCHAM VALUES (2, N'Giáo sư');

-- Table GV_HDDT
CREATE TABLE GV_HDDT (
    MSGV INT REFERENCES GIAOVIEN(MSGV),
    MSDT NVARCHAR(10) REFERENCES DETAI(MSDT),
    DIEM FLOAT,
    PRIMARY KEY (MSGV, MSDT)
);

INSERT INTO GV_HDDT VALUES (1, '97001', 7);
INSERT INTO GV_HDDT VALUES (2, '97002', 8);
INSERT INTO GV_HDDT VALUES (5, '97003', 9);
INSERT INTO GV_HDDT VALUES (4, '97004', 8.5);
INSERT INTO GV_HDDT VALUES (3, '97005', 7);

-- Table GV_PBDT
CREATE TABLE GV_PBDT (
    MSGV INT REFERENCES GIAOVIEN(MSGV),
    MSDT NVARCHAR(10) REFERENCES DETAI(MSDT),
    DIEM FLOAT,
    PRIMARY KEY (MSGV, MSDT)
);

INSERT INTO GV_PBDT VALUES (1, '97005', 5);
INSERT INTO GV_PBDT VALUES (2, '97001', 7);
INSERT INTO GV_PBDT VALUES (5, '97004', 6);
INSERT INTO GV_PBDT VALUES (4, '97003', 8.5);
INSERT INTO GV_PBDT VALUES (3, '97002', 8);

-- Table GV_UVDT
CREATE TABLE GV_UVDT (
    MSGV INT REFERENCES GIAOVIEN(MSGV),
    MSDT NVARCHAR(10) REFERENCES DETAI(MSDT),
    DIEM FLOAT,
    PRIMARY KEY (MSGV, MSDT)
);

INSERT INTO GV_UVDT VALUES (5, '97005', 6);
INSERT INTO GV_UVDT VALUES (2, '97005', 5);
INSERT INTO GV_UVDT VALUES (4, '97005', 5);
INSERT INTO GV_UVDT VALUES (3, '97001', 7);
INSERT INTO GV_UVDT VALUES (4, '97001', 7);
INSERT INTO GV_UVDT VALUES (5, '97001', 8);
INSERT INTO GV_UVDT VALUES (3, '97003', 10);
INSERT INTO GV_UVDT VALUES (1, '97003', 7);
INSERT INTO GV_UVDT VALUES (2, '97003', 7);
INSERT INTO GV_UVDT VALUES (1, '97004', 8);
INSERT INTO GV_UVDT VALUES (2, '97004', 9);
INSERT INTO GV_UVDT VALUES (3, '97004', 5);
INSERT INTO GV_UVDT VALUES (1, '97002', 9);
INSERT INTO GV_UVDT VALUES (4, '97002', 9);
INSERT INTO GV_UVDT VALUES (5, '97002', 6);
INSERT INTO GV_UVDT VALUES (1, '97006', 7);
INSERT INTO GV_UVDT VALUES (2, '97006', 7);
INSERT INTO GV_UVDT VALUES (4, '97006', 7);

CREATE TABLE HOIDONG (
    MSHD INT PRIMARY KEY,
    PHONG NVARCHAR(10),
    TGBD NVARCHAR(5),
    NGAYHD NVARCHAR(10),
    TINHTRANG NVARCHAR(10),
    MSGVCTHD INT REFERENCES GIAOVIEN(MSGV)
);

INSERT INTO HOIDONG VALUES (1, '002', '7:00', '30/10/2001', N'Thật', 1);
INSERT INTO HOIDONG VALUES (2, '102', '7:00', '30/10/2001', N'Thử', 2);
INSERT INTO HOIDONG VALUES (3, '003', '8:00', '31/10/2001', N'Thật', 3);
INSERT INTO HOIDONG VALUES (4, '103', '8:00', '31/10/2001', N'Thử', 4);

-- Table HOIDONG_GV
CREATE TABLE HOIDONG_GV (
    MSHD INT REFERENCES HOIDONG(MSHD),
    MSGV INT REFERENCES GIAOVIEN(MSGV),
    PRIMARY KEY (MSHD, MSGV)
);

INSERT INTO HOIDONG_GV VALUES (1, 1);
INSERT INTO HOIDONG_GV VALUES (1, 2);
INSERT INTO HOIDONG_GV VALUES (1, 3);
INSERT INTO HOIDONG_GV VALUES (1, 4);
INSERT INTO HOIDONG_GV VALUES (2, 3);
INSERT INTO HOIDONG_GV VALUES (2, 2);
INSERT INTO HOIDONG_GV VALUES (2, 5);
INSERT INTO HOIDONG_GV VALUES (2, 4);
INSERT INTO HOIDONG_GV VALUES (3, 1);
INSERT INTO HOIDONG_GV VALUES (3, 2);
INSERT INTO HOIDONG_GV VALUES (3, 3);
INSERT INTO HOIDONG_GV VALUES (3, 4);
INSERT INTO HOIDONG_GV VALUES (4, 3);
INSERT INTO HOIDONG_GV VALUES (4, 2);
INSERT INTO HOIDONG_GV VALUES (4, 5);
INSERT INTO HOIDONG_GV VALUES (4, 4);

-- Table HOIDONG_DT
CREATE TABLE HOIDONG_DT (
    MSHD INT REFERENCES HOIDONG(MSHD),
    MSDT NVARCHAR(10) REFERENCES DETAI(MSDT),
    QUYETDINH NVARCHAR(10),
    PRIMARY KEY (MSHD, MSDT)
);

INSERT INTO HOIDONG_DT VALUES (1, '97001', N'Được');
INSERT INTO HOIDONG_DT VALUES (1, '97002', N'Được');
INSERT INTO HOIDONG_DT VALUES (2, '97003', N'Không');
INSERT INTO HOIDONG_DT VALUES (2, '97004', N'Không');
INSERT INTO HOIDONG_DT VALUES (1, '97005', N'Được');
INSERT INTO HOIDONG_DT VALUES (3, '97001', N'Không');
INSERT INTO HOIDONG_DT VALUES (3, '97002', N'Được');
INSERT INTO HOIDONG_DT VALUES (3, '97004', N'Không');
INSERT INTO HOIDONG_DT VALUES (4, '97003', N'Không');
INSERT INTO HOIDONG_DT VALUES (4, '97005', N'Không');
INSERT INTO HOIDONG_DT VALUES (4, '97006', N'Được');

SELECT DETAI.TENDT AS 'Tên đề tài',
       SINHVIEN.TENSV AS 'Tên sinh viên tham gia',
       GV_HDDT_HUONGDAN.TENGV AS 'Tên giáo viên hướng dẫn',
       GV_HDDT_PHANBIEN.TENGV AS 'Tên giáo viên phản biện'
FROM DETAI
JOIN SV_DETAI ON DETAI.MSDT = SV_DETAI.MSDT
JOIN SINHVIEN ON SV_DETAI.MSSV = SINHVIEN.MSSV
JOIN GV_HDDT GV_HDDT_HUONGDAN ON DETAI.MSDT = GV_HDDT_HUONGDAN.MSDT AND GV_HDDT_HUONGDAN.DIEM IS NOT NULL
JOIN GV_HDDT GV_HDDT_PHANBIEN ON DETAI.MSDT = GV_HDDT_PHANBIEN.MSDT AND GV_HDDT_PHANBIEN.DIEM IS NULL;

-- Corrected query 1
SELECT GIAOVIEN.TENGV AS 'Tên giáo viên',
       DETAI.TENDT AS 'Tên đề tài'
FROM GIAOVIEN
JOIN GV_HDDT ON GIAOVIEN.MSGV = GV_HDDT.MSGV
JOIN DETAI ON GV_HDDT.MSDT = DETAI.MSDT;

-- Corrected query 2
SELECT GIAOVIEN.TENGV AS 'Tên giáo viên',
       DETAI.TENDT AS 'Tên đề tài phản biện'
FROM GIAOVIEN
JOIN GV_HDDT ON GIAOVIEN.MSGV = GV_HDDT.MSGV
JOIN DETAI ON GV_HDDT.MSDT = DETAI.MSDT
WHERE GV_HDDT.DIEM IS NULL;

-- Corrected query 3
SELECT HOIDONG.MSHD AS 'Mã hội đồng',
       DETAI.TENDT AS 'Tên đề tài',
       HOIDONG_DT.QUYETDINH AS 'Quyết định được bảo vệ'
FROM HOIDONG
JOIN HOIDONG_DT ON HOIDONG.MSHD = HOIDONG_DT.MSHD
JOIN DETAI ON HOIDONG_DT.MSDT = DETAI.MSDT;

-- Corrected query 4
SELECT HOIDONG.MSHD AS 'Mã hội đồng',
       DETAI.TENDT AS 'Tên đề tài',
       GV_HDDT.DIEM AS 'Điểm cuối cùng'
FROM HOIDONG
JOIN HOIDONG_DT ON HOIDONG.MSHD = HOIDONG_DT.MSHD
JOIN DETAI ON HOIDONG_DT.MSDT = DETAI.MSDT
JOIN GV_HDDT ON DETAI.MSDT = GV_HDDT.MSDT AND HOIDONG_DT.MSGV = GV_HDDT.MSGV;

-- Corrected query 5
SELECT DETAI.TENDT AS 'Tên đề tài',
       SINHVIEN.TENSV AS 'Tên sinh viên',
       GIAOVIEN.TENGV AS 'Tên giáo viên',
       GV_HDDT.DIEM AS 'Điểm'
FROM DETAI
JOIN SV_DETAI ON DETAI.MSDT = SV_DETAI.MSDT
JOIN SINHVIEN ON SV_DETAI.MSSV = SINHVIEN.MSSV
JOIN HOIDONG_DT ON DETAI.MSDT = HOIDONG_DT.MSDT
JOIN GIAOVIEN ON HOIDONG_DT.MSGV = GIAOVIEN.MSGV
JOIN GV_HDDT ON DETAI.MSDT = GV_HDDT.MSDT AND HOIDONG_DT.MSGV = GV_HDDT.MSGV;

-- Corrected query 6
SELECT HOIDONG.TGBD AS 'Thời gian bắt đầu',
       HOIDONG.NGAYHD AS 'Ngày',
       COUNT(HOIDONG_DT.MSDT) AS 'Số lượng đề tài bảo vệ',
       GIAOVIEN.TENGV AS 'Tên chủ tịch hội đồng'
FROM HOIDONG
JOIN HOIDONG_DT ON HOIDONG.MSHD = HOIDONG_DT.MSHD
JOIN GIAOVIEN ON HOIDONG.MSGVCTHD = GIAOVIEN.MSGV
GROUP BY HOIDONG.MSHD, HOIDONG.TGBD, HOIDONG.NGAYHD, GIAOVIEN.TENGV;

-- Corrected query 7
SELECT DISTINCT GIAOVIEN.TENGV AS 'Tên giáo viên',
                GIAOVIEN.SODT AS 'Số điện thoại'
FROM GIAOVIEN
JOIN HOIDONG_GV ON GIAOVIEN.MSGV = HOIDONG_GV.MSGV;

-- Corrected query 8
SELECT DETAI.TENDT AS 'Tên đề tài',
       SINHVIEN.TENSV AS 'Tên sinh viên tham gia',
       GV_HDDT_HUONGDAN.TENGV AS 'Tên giáo viên hướng dẫn',
       GV_HDDT_PHANBIEN.TENGV AS 'Tên giáo viên phản biện'
FROM DETAI
JOIN SV_DETAI ON DETAI.MSDT = SV_DETAI.MSDT
JOIN SINHVIEN ON SV_DETAI.MSSV = SINHVIEN.MSSV
JOIN GV_HDDT GV_HDDT_HUONGDAN ON DETAI.MSDT = GV_HDDT_HUONGDAN.MSDT AND GV_HDDT_HUONGDAN.DIEM IS NOT NULL
JOIN GV_HDDT GV_HDDT_PHANBIEN ON DETAI.MSDT = GV_HDDT_PHANBIEN.MSDT AND GV_HDDT_PHANBIEN.DIEM IS NULL;
